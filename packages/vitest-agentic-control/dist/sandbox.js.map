{"version":3,"sources":["../src/sandbox.ts"],"names":[],"mappings":"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","file":"sandbox.js","sourcesContent":["/**\n * Sandbox execution mocking utilities for agentic-control testing.\n *\n * This module provides utilities for mocking Docker container execution\n * and sandbox operations during testing. It allows you to simulate\n * container behavior without needing actual Docker.\n *\n * @module sandbox\n */\n\nimport { type Mock, vi } from 'vitest';\n\n/**\n * Mock container configuration.\n */\nexport interface MockContainerConfig {\n  /** Container ID */\n  id?: string;\n  /** Container name */\n  name?: string;\n  /** Image name */\n  image?: string;\n  /** Working directory */\n  workdir?: string;\n  /** Environment variables */\n  env?: Record<string, string>;\n  /** Memory limit in MB */\n  memory?: number;\n  /** Timeout in ms */\n  timeout?: number;\n}\n\n/**\n * Mock execution result.\n */\nexport interface MockExecutionResult {\n  /** Whether execution succeeded */\n  success: boolean;\n  /** Exit code */\n  exitCode?: number;\n  /** Standard output */\n  stdout?: string;\n  /** Standard error */\n  stderr?: string;\n  /** Output files */\n  files?: Array<{\n    path: string;\n    content: string | Buffer;\n  }>;\n  /** Execution duration in ms */\n  duration?: number;\n  /** Error if execution failed */\n  error?: Error;\n}\n\n/**\n * Options for creating a SandboxMocker instance.\n */\nexport interface SandboxMockerOptions {\n  /** Default container configuration */\n  defaultConfig?: MockContainerConfig;\n  /** Default execution result */\n  defaultResult?: MockExecutionResult;\n  /** Whether to auto-mock Docker commands */\n  autoMock?: boolean;\n}\n\n/**\n * Mock container instance.\n */\nexport interface MockContainer {\n  /** Container configuration */\n  config: MockContainerConfig;\n  /** Container status */\n  status: 'created' | 'running' | 'stopped' | 'removed';\n  /** Execution history */\n  executions: Array<{\n    command: string[];\n    result: MockExecutionResult;\n    timestamp: Date;\n  }>;\n  /** Mock methods */\n  start: Mock<() => Promise<void>>;\n  stop: Mock<() => Promise<void>>;\n  exec: Mock<(command: string[]) => Promise<MockExecutionResult>>;\n  remove: Mock<() => Promise<void>>;\n  copyTo: Mock<(hostPath: string, containerPath: string) => Promise<void>>;\n  copyFrom: Mock<(containerPath: string, hostPath: string) => Promise<void>>;\n}\n\n/**\n * Sandbox execution mocking utilities class.\n *\n * Provides methods for mocking Docker container execution during testing.\n *\n * @example\n * ```typescript\n * import { SandboxMocker } from 'vitest-agentic-control';\n *\n * const mocker = new SandboxMocker();\n *\n * // Mock successful execution\n * mocker.mockExecution({\n *   success: true,\n *   stdout: 'Hello from container!',\n *   exitCode: 0,\n * });\n *\n * // Create a mock container\n * const container = mocker.createMockContainer({\n *   image: 'node:22',\n *   workdir: '/app',\n * });\n *\n * // Execute command in mock container\n * const result = await container.exec(['npm', 'test']);\n * expect(result.success).toBe(true);\n * ```\n */\nexport class SandboxMocker {\n  /** Default container configuration */\n  private defaultConfig: MockContainerConfig;\n\n  /** Default execution result */\n  private defaultResult: MockExecutionResult;\n\n  /** Track mock containers */\n  public readonly containers: Map<string, MockContainer> = new Map();\n\n  /** Track mocked modules */\n  private readonly mockedModules: Set<string> = new Set();\n\n  /** Queue of results to return from executions */\n  private resultQueue: MockExecutionResult[] = [];\n\n  /** Counter for generating container IDs */\n  private containerIdCounter = 0;\n\n  constructor(options: SandboxMockerOptions = {}) {\n    this.defaultConfig = options.defaultConfig ?? {\n      image: 'node:22-slim',\n      workdir: '/workspace',\n    };\n\n    this.defaultResult = options.defaultResult ?? {\n      success: true,\n      exitCode: 0,\n      stdout: '',\n      stderr: '',\n    };\n\n    if (options.autoMock) {\n      this.mockDockerCommands();\n    }\n  }\n\n  /**\n   * Set the default execution result.\n   *\n   * @param result - The result to return from executions\n   */\n  mockExecution(result: MockExecutionResult): void {\n    this.defaultResult = result;\n  }\n\n  /**\n   * Queue a result to be returned from the next execution.\n   *\n   * @param result - The result to queue\n   */\n  queueResult(result: MockExecutionResult): void {\n    this.resultQueue.push(result);\n  }\n\n  /**\n   * Queue multiple results to be returned from executions.\n   *\n   * @param results - The results to queue\n   */\n  queueResults(results: MockExecutionResult[]): void {\n    this.resultQueue.push(...results);\n  }\n\n  /**\n   * Get the next result from the queue or the default.\n   */\n  private getNextResult(): MockExecutionResult {\n    return this.resultQueue.shift() ?? this.defaultResult;\n  }\n\n  /**\n   * Create a mock container.\n   *\n   * @param config - Container configuration\n   * @returns Mock container instance\n   */\n  createMockContainer(config: MockContainerConfig = {}): MockContainer {\n    const mergedConfig: MockContainerConfig = {\n      ...this.defaultConfig,\n      ...config,\n      id: config.id ?? `mock-container-${++this.containerIdCounter}`,\n      name: config.name ?? `mock-container-${this.containerIdCounter}`,\n    };\n\n    const containerId = mergedConfig.id || 'unknown';\n    const container: MockContainer = {\n      config: mergedConfig,\n      status: 'created',\n      executions: [],\n\n      start: vi.fn(async () => {\n        container.status = 'running';\n      }),\n\n      stop: vi.fn(async () => {\n        container.status = 'stopped';\n      }),\n\n      exec: vi.fn(async (command: string[]) => {\n        const result = this.getNextResult();\n        container.executions.push({\n          command,\n          result,\n          timestamp: new Date(),\n        });\n\n        if (result.error) {\n          throw result.error;\n        }\n\n        return result;\n      }),\n\n      remove: vi.fn(async () => {\n        container.status = 'removed';\n        this.containers.delete(containerId);\n      }),\n\n      copyTo: vi.fn(async () => {\n        // Mock file copy to container\n      }),\n\n      copyFrom: vi.fn(async () => {\n        // Mock file copy from container\n      }),\n    };\n\n    this.containers.set(containerId, container);\n    return container;\n  }\n\n  /**\n   * Mock Docker CLI commands.\n   */\n  mockDockerCommands(): void {\n    // Mock child_process for Docker commands\n    vi.doMock('child_process', () => ({\n      spawn: vi.fn((command: string, args: string[]) => {\n        const isDocker = command === 'docker' || command.includes('docker');\n\n        if (isDocker) {\n          return this.createMockDockerProcess(args);\n        }\n\n        // Return a basic mock process for non-Docker commands\n        return {\n          stdout: { on: vi.fn() },\n          stderr: { on: vi.fn() },\n          on: vi.fn((event: string, cb: (code: number) => void) => {\n            if (event === 'close') {\n              cb(0);\n            }\n          }),\n          kill: vi.fn(),\n        };\n      }),\n\n      spawnSync: vi.fn((command: string, _args: string[]) => {\n        const isDocker = command === 'docker' || command.includes('docker');\n\n        if (isDocker) {\n          const result = this.getNextResult();\n          return {\n            status: result.exitCode ?? 0,\n            stdout: Buffer.from(result.stdout ?? ''),\n            stderr: Buffer.from(result.stderr ?? ''),\n            error: result.error,\n          };\n        }\n\n        return {\n          status: 0,\n          stdout: Buffer.from(''),\n          stderr: Buffer.from(''),\n        };\n      }),\n\n      execSync: vi.fn((command: string) => {\n        if (command.includes('docker')) {\n          return this.defaultResult.stdout ?? '';\n        }\n        return '';\n      }),\n    }));\n\n    this.mockedModules.add('child_process');\n  }\n\n  /**\n   * Create a mock Docker process.\n   */\n  private createMockDockerProcess(args: string[]): unknown {\n    const result = this.getNextResult();\n\n    // Parse Docker command\n    const subcommand = args[0];\n\n    const process = {\n      stdout: {\n        on: vi.fn((event: string, cb: (data: Buffer) => void) => {\n          if (event === 'data' && result.stdout) {\n            cb(Buffer.from(result.stdout));\n          }\n        }),\n      },\n      stderr: {\n        on: vi.fn((event: string, cb: (data: Buffer) => void) => {\n          if (event === 'data' && result.stderr) {\n            cb(Buffer.from(result.stderr));\n          }\n        }),\n      },\n      on: vi.fn((event: string, cb: (code: number) => void) => {\n        if (event === 'close') {\n          setTimeout(() => cb(result.exitCode ?? 0), 10);\n        }\n      }),\n      kill: vi.fn(),\n    };\n\n    // Handle specific Docker commands\n    if (subcommand === 'run') {\n      // Create a mock container when docker run is called\n      const container = this.createMockContainer({\n        image: args.find((_a, i) => args[i - 1] === '--image') ?? 'unknown',\n      });\n      container.status = 'running';\n    }\n\n    return process;\n  }\n\n  /**\n   * Mock the ContainerManager class from agentic-control.\n   */\n  mockContainerManager(): Mock {\n    const mockManager = vi.fn().mockImplementation(() => ({\n      createContainer: vi.fn(async (config: MockContainerConfig) => {\n        return this.createMockContainer(config);\n      }),\n      startContainer: vi.fn(async (id: string) => {\n        const container = this.containers.get(id);\n        if (container) {\n          await container.start();\n        }\n      }),\n      stopContainer: vi.fn(async (id: string) => {\n        const container = this.containers.get(id);\n        if (container) {\n          await container.stop();\n        }\n      }),\n      removeContainer: vi.fn(async (id: string) => {\n        const container = this.containers.get(id);\n        if (container) {\n          await container.remove();\n        }\n      }),\n      execInContainer: vi.fn(async (id: string, command: string[]) => {\n        const container = this.containers.get(id);\n        if (container) {\n          return container.exec(command);\n        }\n        throw new Error(`Container not found: ${id}`);\n      }),\n    }));\n\n    vi.doMock('agentic-control/sandbox', () => ({\n      ContainerManager: mockManager,\n    }));\n\n    this.mockedModules.add('agentic-control/sandbox');\n    return mockManager;\n  }\n\n  /**\n   * Mock the SandboxExecutor class from agentic-control.\n   */\n  mockSandboxExecutor(): Mock {\n    const mockExecutor = vi.fn().mockImplementation(() => ({\n      execute: vi.fn(async () => {\n        return this.getNextResult();\n      }),\n      executeWithTimeout: vi.fn(async () => {\n        return this.getNextResult();\n      }),\n    }));\n\n    vi.doMock('agentic-control/sandbox', () => ({\n      SandboxExecutor: mockExecutor,\n    }));\n\n    this.mockedModules.add('agentic-control/sandbox');\n    return mockExecutor;\n  }\n\n  /**\n   * Create a mock runtime adapter.\n   *\n   * @param name - Runtime name\n   * @param command - Command to return from prepareCommand\n   */\n  createMockRuntime(\n    name: string,\n    command: string[] = ['echo', 'mock']\n  ): {\n    name: string;\n    prepareCommand: Mock<(prompt: string, options?: unknown) => string[]>;\n    parseOutput: Mock<(output: string) => unknown>;\n  } {\n    return {\n      name,\n      prepareCommand: vi.fn(() => command),\n      parseOutput: vi.fn((output: string) => ({ output })),\n    };\n  }\n\n  /**\n   * Get all container IDs.\n   */\n  getContainerIds(): string[] {\n    return Array.from(this.containers.keys());\n  }\n\n  /**\n   * Get a container by ID.\n   */\n  getContainer(id: string): MockContainer | undefined {\n    return this.containers.get(id);\n  }\n\n  /**\n   * Restore all mocked modules.\n   */\n  restoreAll(): void {\n    this.mockedModules.clear();\n    this.containers.clear();\n    this.resultQueue = [];\n  }\n\n  /**\n   * Reset all mocks.\n   */\n  resetAll(): void {\n    for (const container of this.containers.values()) {\n      container.start.mockClear();\n      container.stop.mockClear();\n      container.exec.mockClear();\n      container.remove.mockClear();\n      container.copyTo.mockClear();\n      container.copyFrom.mockClear();\n      container.executions = [];\n    }\n    this.resultQueue = [];\n  }\n}\n\n/**\n * Factory function to create a SandboxMocker instance.\n *\n * @param options - Configuration options\n * @returns A new SandboxMocker instance\n */\nexport function createSandboxMocker(options: SandboxMockerOptions = {}): SandboxMocker {\n  return new SandboxMocker(options);\n}\n"]}