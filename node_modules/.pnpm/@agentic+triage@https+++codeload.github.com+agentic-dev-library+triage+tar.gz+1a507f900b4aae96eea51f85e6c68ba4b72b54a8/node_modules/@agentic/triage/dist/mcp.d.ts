/**
 * MCP (Model Context Protocol) Integration
 *
 * This module provides unified access to all MCP servers used by triage:
 *
 * | Server         | Purpose                                              |
 * |----------------|------------------------------------------------------|
 * | **Filesystem** | Read/write files - CRITICAL for Ollama's limited context |
 * | **GitHub**     | Issues, PRs, projects, commits - full GitHub API    |
 * | **Playwright** | Browser automation, E2E testing, visual verification |
 * | **Context7**   | Library documentation lookup - PREVENTS HALLUCINATIONS |
 * | **Vite React** | React component debugging, state inspection, render tracking |
 *
 * ## Key Design Principles
 *
 * 1. **Ollama has LIMITED context** - The AI MUST use filesystem tools to read
 *    file contents and write changes directly. We cannot fit entire codebases
 *    in the prompt.
 *
 * 2. **Context7 prevents hallucinations** - Instead of guessing API details,
 *    the AI can look up actual library documentation.
 *
 * 3. **Vite React MCP** - For debugging React apps during development/testing,
 *    can inspect component tree, props, state, and track unnecessary re-renders.
 *
 * 4. **GitHub MCP** - Full API access for issues, PRs, projects without
 *    needing to shell out to `gh` CLI.
 */
import { experimental_createMCPClient as createMCPClient } from '@ai-sdk/mcp';
import { type ToolSet } from './ai.js';
export type MCPClient = Awaited<ReturnType<typeof createMCPClient>>;
/**
 * Create Filesystem MCP client for file operations
 *
 * Uses an inline server for reliability (no npx dependency).
 * This is the MOST IMPORTANT MCP - it lets the AI read and write files
 * since Ollama can't fit everything in context.
 */
export declare function createFilesystemClient(workingDirectory: string): Promise<MCPClient>;
/**
 * Inline filesystem MCP server
 *
 * Provides: read_file, write_file, list_files, search_files
 * All paths are sandboxed to workingDirectory for security.
 */
export declare function createInlineFilesystemClient(workingDirectory: string): Promise<MCPClient>;
/**
 * Get filesystem tools from client
 */
export declare function getFilesystemTools(client: MCPClient): Promise<ToolSet>;
/**
 * Create GitHub MCP client for issue/PR/project operations
 *
 * Provides access to:
 * - create_issue, update_issue, get_issue
 * - create_pull_request, merge_pull_request
 * - add_label, remove_label
 * - get_file_contents, create_or_update_file
 * - search_issues, search_repositories
 */
export declare function createGitHubClient(): Promise<MCPClient>;
/**
 * Get GitHub tools from client
 */
export declare function getGitHubTools(client: MCPClient): Promise<ToolSet>;
/**
 * Create Playwright MCP client for browser automation
 *
 * Used for E2E testing, visual verification, and user flow testing.
 *
 * Provides:
 * - browser_navigate, browser_click, browser_type
 * - browser_snapshot, browser_take_screenshot
 * - browser_verify_* (with testing capabilities)
 */
export declare function createPlaywrightClient(options?: {
    headless?: boolean;
    browser?: 'chromium' | 'firefox' | 'webkit';
    outputDir?: string;
    testingCapabilities?: boolean;
}): Promise<MCPClient>;
/**
 * Get Playwright tools from client
 */
export declare function getPlaywrightTools(client: MCPClient): Promise<ToolSet>;
/**
 * Create Context7 MCP client for library documentation lookup
 *
 * CRITICAL for preventing hallucinations!
 * Provides access to up-to-date library documentation so the AI can
 * reference-check instead of making up API details.
 *
 * Tools provided:
 * - resolve-library-id: Find Context7 library ID from name
 * - get-library-docs: Get documentation for a library
 *
 * Uses HTTP transport to Context7's cloud service.
 * Requires CONTEXT7_API_KEY environment variable.
 */
export declare function createContext7Client(): Promise<MCPClient>;
/**
 * Get Context7 tools from client
 *
 * Available tools:
 * - resolve-library-id: Resolve library name to Context7 ID
 * - get-library-docs: Get library documentation
 */
export declare function getContext7Tools(client: MCPClient): Promise<ToolSet>;
/**
 * Create Vite React MCP client for React component debugging
 *
 * Connects to a running Vite dev server with the vite-react-mcp plugin.
 * Used for debugging React apps during development and testing.
 *
 * Tools provided:
 * - highlight-component: Highlight a React component by name
 * - get-component-states: Get props, states, and contexts
 * - get-component-tree: Get component tree in ASCII format
 * - get-unnecessary-rerenders: Track wasted renders
 *
 * Requires the app to be running with vite-react-mcp plugin installed.
 */
export declare function createViteReactClient(options?: {
    /** URL of the Vite dev server SSE endpoint (default: http://localhost:5173/sse) */
    url?: string;
    /** Port number (alternative to full URL) */
    port?: number;
}): Promise<MCPClient>;
/**
 * Get Vite React tools from client
 */
export declare function getViteReactTools(client: MCPClient): Promise<ToolSet>;
/**
 * Create GraphQL MCP client for GitHub GraphQL API operations
 *
 * Uses mcp-graphql to execute GraphQL queries/mutations against GitHub's API.
 * Required for: Projects V2, review threads, draft PR conversion, auto-merge, etc.
 */
export declare function createGraphQLClient(): Promise<MCPClient>;
/**
 * Get GraphQL tools from client
 */
export declare function getGraphQLTools(client: MCPClient): Promise<ToolSet>;
export interface MCPClients {
    filesystem?: MCPClient;
    github?: MCPClient;
    playwright?: MCPClient;
    context7?: MCPClient;
    viteReact?: MCPClient;
    graphql?: MCPClient;
}
export interface MCPClientOptions {
    /** Enable filesystem access (required for most tasks) */
    filesystem?: boolean | string;
    /** Enable GitHub API access */
    github?: boolean;
    /** Enable Playwright browser automation */
    playwright?: boolean | {
        headless?: boolean;
        browser?: 'chromium' | 'firefox' | 'webkit';
    };
    /** Enable Context7 documentation lookup (PREVENTS HALLUCINATIONS!) */
    context7?: boolean;
    /** Enable Vite React component debugging */
    viteReact?: boolean | {
        url?: string;
        port?: number;
    };
    /** Enable GitHub GraphQL API access via mcp-graphql */
    graphql?: boolean;
}
/**
 * Initialize multiple MCP clients based on options
 *
 * @example
 * const clients = await initializeMCPClients({
 *     filesystem: process.cwd(),  // Required for file access
 *     context7: true,             // Documentation lookup - prevents hallucinations
 *     github: true,               // Issue/PR operations
 * });
 */
export declare function initializeMCPClients(options: MCPClientOptions): Promise<MCPClients>;
/**
 * Get combined tools from all active MCP clients
 *
 * Tools are available without prefixes for simpler prompts.
 */
export declare function getAllTools(clients: MCPClients): Promise<ToolSet>;
/**
 * Close all MCP clients - ALWAYS call this when done!
 */
export declare function closeMCPClients(clients: MCPClients): Promise<void>;
export interface AgenticTaskOptions {
    /** System prompt defining the AI's role and behavior */
    systemPrompt: string;
    /** User prompt with the actual task */
    userPrompt: string;
    /** MCP clients to enable */
    mcpClients?: MCPClientOptions;
    /** Maximum steps for the agentic loop (default: 15) */
    maxSteps?: number;
    /** Callback for each tool call */
    onToolCall?: (toolName: string, args: unknown) => void;
    /** Callback for each step completion */
    onStepFinish?: (step: {
        text?: string;
        toolCalls?: unknown[];
    }) => void;
}
export interface AgenticTaskResult {
    /** Final text response from the AI */
    text: string;
    /** Total number of tool calls made */
    toolCallCount: number;
    /** All steps in the agentic loop */
    steps: unknown[];
    /** Reason the loop finished */
    finishReason: string;
}
/**
 * Run an agentic task with MCP tools
 *
 * This is the main entry point for AI tasks that need tool access.
 * Properly handles the agentic loop via AI SDK's stopWhen.
 *
 * @example
 * const result = await runAgenticTask({
 *     systemPrompt: 'You are a code reviewer...',
 *     userPrompt: 'Review this PR diff...',
 *     mcpClients: {
 *         filesystem: process.cwd(),  // Read files for context
 *         context7: true,              // Check documentation - prevents hallucinations
 *     },
 *     maxSteps: 15,
 *     onToolCall: (name, args) => console.log(`Using ${name}`),
 * });
 */
export declare function runAgenticTask(options: AgenticTaskOptions): Promise<AgenticTaskResult>;
/**
 * Playwright tool names for reference
 */
export declare const PLAYWRIGHT_TOOLS: {
    readonly NAVIGATE: "browser_navigate";
    readonly CLICK: "browser_click";
    readonly TYPE: "browser_type";
    readonly SNAPSHOT: "browser_snapshot";
    readonly SCREENSHOT: "browser_take_screenshot";
    readonly CLOSE: "browser_close";
    readonly WAIT: "browser_wait_for";
    readonly EVALUATE: "browser_evaluate";
    readonly VERIFY_ELEMENT_VISIBLE: "browser_verify_element_visible";
    readonly VERIFY_TEXT_VISIBLE: "browser_verify_text_visible";
    readonly VERIFY_VALUE: "browser_verify_value";
    readonly GENERATE_LOCATOR: "browser_generate_locator";
};
/**
 * Filesystem tool names for reference
 */
export declare const FILESYSTEM_TOOLS: {
    readonly READ_FILE: "read_file";
    readonly WRITE_FILE: "write_file";
    readonly LIST_FILES: "list_files";
    readonly SEARCH_FILES: "search_files";
};
/**
 * Context7 tool names for reference
 */
export declare const CONTEXT7_TOOLS: {
    /** Resolve library name to Context7 ID */
    readonly RESOLVE_LIBRARY_ID: "resolve-library-id";
    /** Get library documentation */
    readonly GET_LIBRARY_DOCS: "get-library-docs";
};
/**
 * Vite React tool names for reference
 */
export declare const VITE_REACT_TOOLS: {
    /** Highlight a React component */
    readonly HIGHLIGHT_COMPONENT: "highlight-component";
    /** Get component props, states, contexts */
    readonly GET_COMPONENT_STATES: "get-component-states";
    /** Get component tree */
    readonly GET_COMPONENT_TREE: "get-component-tree";
    /** Get unnecessary re-renders */
    readonly GET_UNNECESSARY_RERENDERS: "get-unnecessary-rerenders";
};
/**
 * GitHub MCP tool names for reference
 *
 * From @modelcontextprotocol/server-github
 */
export declare const GITHUB_TOOLS: {
    /** Post a comment on an issue or PR */
    readonly ADD_ISSUE_COMMENT: "add_issue_comment";
    /** Create a new issue */
    readonly CREATE_ISSUE: "create_issue";
    /** Get issue details */
    readonly GET_ISSUE: "get_issue";
    /** Update an issue */
    readonly UPDATE_ISSUE: "update_issue";
    /** Search issues */
    readonly SEARCH_ISSUES: "search_issues";
    /** Create a new pull request */
    readonly CREATE_PULL_REQUEST: "create_pull_request";
    /** Get pull request details */
    readonly GET_PULL_REQUEST: "get_pull_request";
    /** Get file contents from a repo */
    readonly GET_FILE_CONTENTS: "get_file_contents";
    /** Create or update a file */
    readonly CREATE_OR_UPDATE_FILE: "create_or_update_file";
    /** List commits */
    readonly LIST_COMMITS: "list_commits";
    /** Fork a repository */
    readonly FORK_REPOSITORY: "fork_repository";
    /** Create a branch */
    readonly CREATE_BRANCH: "create_branch";
};
//# sourceMappingURL=mcp.d.ts.map