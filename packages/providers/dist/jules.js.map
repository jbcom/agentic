{"version":3,"sources":["../src/jules.ts"],"names":[],"mappings":"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","file":"jules.js","sourcesContent":["/**\n * Google Jules Provider Implementation\n *\n * Creates agents that use Google Jules for complex async tasks.\n * Jules can create PRs, run commands, and handle multi-file changes.\n */\n\nimport type { AgentCapabilities, AgentDefinition, AgentResult, AgentTask } from '@agentic/triage';\n\nexport interface JulesConfig {\n  /** Jules API key */\n  apiKey: string;\n  /** API base URL (default: https://jules.googleapis.com/v1alpha) */\n  baseUrl?: string;\n  /** Automation mode (default: AUTO_CREATE_PR) */\n  automationMode?: 'AUTOMATION_MODE_UNSPECIFIED' | 'AUTO_CREATE_PR' | 'MANUAL';\n}\n\nexport interface JulesSessionResult {\n  /** Session ID for polling */\n  sessionId: string;\n  /** Session name/resource path */\n  name: string;\n  /** Current state */\n  state: string;\n}\n\nconst DEFAULT_BASE_URL = 'https://jules.googleapis.com/v1alpha';\n\n/**\n * Create a Jules-based agent for the registry\n */\nexport function createJulesAgent(\n  id: string,\n  config: JulesConfig,\n  options: {\n    name?: string;\n    cost?: number;\n    priority?: number;\n    capabilities?: Partial<AgentCapabilities>;\n  } = {}\n): AgentDefinition<JulesSessionResult> {\n  const baseUrl = config.baseUrl ?? DEFAULT_BASE_URL;\n  const automationMode = config.automationMode ?? 'AUTO_CREATE_PR';\n\n  return {\n    id,\n    name: options.name ?? 'Google Jules',\n    cost: options.cost ?? 0, // Free tier\n    priority: options.priority ?? 10, // Lower priority than Ollama\n    enabled: true,\n    requiresApproval: false,\n    capabilities: {\n      tiers: ['moderate', 'complex', 'expert'],\n      maxContext: 100000,\n      canCreatePR: true,\n      canExecute: true,\n      async: true, // Jules is async - returns job ID\n      ...options.capabilities,\n    },\n    execute: async (task: AgentTask): Promise<AgentResult<JulesSessionResult>> => {\n      try {\n        const response = await fetch(`${baseUrl}/sessions`, {\n          method: 'POST',\n          headers: {\n            'X-Goog-Api-Key': config.apiKey,\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            prompt: formatJulesPrompt(task),\n            sourceContext: task.repo\n              ? {\n                  source: `sources/github/${task.repo}`,\n                  githubRepoContext: {\n                    startingBranch: 'main',\n                  },\n                }\n              : undefined,\n            automationMode,\n          }),\n        });\n\n        if (!response.ok) {\n          const error = await response.text();\n          return {\n            success: false,\n            error: `Jules API error: ${response.status} - ${error}`,\n            escalate: true,\n            cost: 0,\n          };\n        }\n\n        const result = await response.json();\n\n        return {\n          success: true,\n          data: {\n            sessionId: result.name?.split('/').pop() ?? result.name,\n            name: result.name,\n            state: result.state ?? 'PENDING',\n          },\n          jobId: result.name, // Caller should poll this\n          cost: 0,\n        };\n      } catch (error) {\n        return {\n          success: false,\n          error: error instanceof Error ? error.message : 'Unknown error',\n          escalate: true,\n          cost: 0,\n        };\n      }\n    },\n  };\n}\n\n/**\n * Poll a Jules session for completion\n */\nexport async function pollJulesSession(\n  config: JulesConfig,\n  sessionName: string\n): Promise<{ state: string; prUrl?: string; error?: string }> {\n  const baseUrl = config.baseUrl ?? DEFAULT_BASE_URL;\n\n  const response = await fetch(`${baseUrl}/${sessionName}`, {\n    headers: {\n      'X-Goog-Api-Key': config.apiKey,\n    },\n  });\n\n  if (!response.ok) {\n    throw new Error(`Failed to poll session: ${response.status}`);\n  }\n\n  const result = await response.json();\n\n  return {\n    state: result.state,\n    prUrl: result.pullRequestUrl,\n    error: result.error?.message,\n  };\n}\n\n/**\n * Send a follow-up message to a Jules session\n */\nexport async function sendJulesFollowUp(\n  config: JulesConfig,\n  sessionName: string,\n  message: string\n): Promise<void> {\n  const baseUrl = config.baseUrl ?? DEFAULT_BASE_URL;\n\n  const response = await fetch(`${baseUrl}/${sessionName}:addUserResponse`, {\n    method: 'POST',\n    headers: {\n      'X-Goog-Api-Key': config.apiKey,\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({ userResponse: message }),\n  });\n\n  if (!response.ok) {\n    throw new Error(`Failed to send follow-up: ${response.status}`);\n  }\n}\n\nfunction formatJulesPrompt(task: AgentTask): string {\n  return `${task.description}\n\nContext:\n${task.context}\n\nRequirements:\n- Create a PR with your changes\n- Ensure all tests pass\n- Follow existing code style\n- Add appropriate documentation`;\n}\n"]}