{"version":3,"sources":["../src/cursor.ts"],"names":[],"mappings":"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","file":"cursor.js","sourcesContent":["/**\n * Cursor Cloud Agent Provider Implementation\n *\n * Creates agents that use Cursor Cloud Agents for expert-level tasks.\n * WARNING: Cursor Cloud Agents are expensive - use sparingly!\n */\n\nimport type { AgentCapabilities, AgentDefinition, AgentResult, AgentTask } from '@agentic/triage';\n\nexport interface CursorConfig {\n  /** Cursor API key */\n  apiKey: string;\n  /** API base URL (default: https://api.cursor.com/v0) */\n  baseUrl?: string;\n  /** Workspace path in the cloud environment */\n  workspacePath?: string;\n}\n\nexport interface CursorAgentResult {\n  /** Agent ID */\n  agentId: string;\n  /** Current status */\n  status: string;\n  /** Output messages */\n  messages?: Array<{ role: string; content: string }>;\n}\n\nconst DEFAULT_BASE_URL = 'https://api.cursor.com/v0';\n\n/**\n * Create a Cursor Cloud Agent for the registry\n *\n * ⚠️ EXPENSIVE - Requires explicit approval by default\n */\nexport function createCursorAgent(\n  id: string,\n  config: CursorConfig,\n  options: {\n    name?: string;\n    cost?: number;\n    priority?: number;\n    requiresApproval?: boolean;\n    capabilities?: Partial<AgentCapabilities>;\n  } = {}\n): AgentDefinition<CursorAgentResult> {\n  const baseUrl = config.baseUrl ?? DEFAULT_BASE_URL;\n\n  return {\n    id,\n    name: options.name ?? 'Cursor Cloud Agent',\n    cost: options.cost ?? 100, // Expensive!\n    priority: options.priority ?? 100, // Very low priority (last resort)\n    enabled: true,\n    requiresApproval: options.requiresApproval ?? true, // Require approval by default\n    capabilities: {\n      tiers: ['expert'], // Only for expert-level tasks\n      maxContext: 200000,\n      canCreatePR: true,\n      canExecute: true,\n      async: true,\n      ...options.capabilities,\n    },\n    execute: async (task: AgentTask): Promise<AgentResult<CursorAgentResult>> => {\n      try {\n        const response = await fetch(`${baseUrl}/agents`, {\n          method: 'POST',\n          headers: {\n            Authorization: `Bearer ${config.apiKey}`,\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            messages: [\n              {\n                role: 'user',\n                content: formatCursorPrompt(task),\n              },\n            ],\n            workspacePath: config.workspacePath,\n          }),\n        });\n\n        if (!response.ok) {\n          const error = await response.text();\n          return {\n            success: false,\n            error: `Cursor API error: ${response.status} - ${error}`,\n            escalate: false, // No more tiers to escalate to\n            cost: 0, // Don't charge for failed requests\n          };\n        }\n\n        const result = await response.json();\n\n        return {\n          success: true,\n          data: {\n            agentId: result.id ?? result.agentId,\n            status: result.status ?? 'running',\n            messages: result.messages,\n          },\n          jobId: result.id, // Caller should poll\n          cost: 100, // Charge for successful spawn\n        };\n      } catch (error) {\n        return {\n          success: false,\n          error: error instanceof Error ? error.message : 'Unknown error',\n          escalate: false,\n          cost: 0,\n        };\n      }\n    },\n  };\n}\n\n/**\n * Poll a Cursor agent for status\n */\nexport async function pollCursorAgent(\n  config: CursorConfig,\n  agentId: string\n): Promise<CursorAgentResult> {\n  const baseUrl = config.baseUrl ?? DEFAULT_BASE_URL;\n\n  const response = await fetch(`${baseUrl}/agents/${agentId}`, {\n    headers: {\n      Authorization: `Bearer ${config.apiKey}`,\n    },\n  });\n\n  if (!response.ok) {\n    throw new Error(`Failed to poll agent: ${response.status}`);\n  }\n\n  const result = await response.json();\n\n  return {\n    agentId: result.id,\n    status: result.status,\n    messages: result.messages,\n  };\n}\n\nfunction formatCursorPrompt(task: AgentTask): string {\n  return `You are an expert developer. Complete this complex task:\n\nTASK: ${task.description}\n\nREPOSITORY: ${task.repo ?? 'Unknown'}\n\nCONTEXT:\n${task.context}\n\nThis task was escalated to you because simpler approaches failed.\nTake your time, analyze carefully, and provide a complete solution.`;\n}\n"]}